import math

def getxy(lng,lat,z):
    # 经纬度与当前等级的瓦片坐标的映射
    # 固定值
    CF = [
        [-0.0015702102444,      111320.7020616939, 1704480524535203,    -10338987376042340,     26112667856603880,      -35149669176653700,     26595700718403920,      -10725012454188240,     1800819912950474, 82.5], 
        [8.277824516172526E-4,  111320.7020463578, 6.477955746671607E8, -4.082003173641316E9,   1.077490566351142E10,   -1.517187553151559E10,  1.205306533862167E10,   -5.124939663577472E9,   9.133119359512032E8, 67.5], 
        [0.00337398766765,      111320.7020202162, 4481351.045890365,   -2.339375119931662E7,   7.968221547186455E7,    -1.159649932797253E8,   9.723671115602145E7,    -4.366194633752821E7,   8477230.501135234, 52.5], 
        [0.00220636496208,      111320.7020209128, 51751.86112841131,   3796837.749470245,      992013.7397791013,      -1221952.21711287,      1340652.697009075,      -620943.6990984312,     144416.9293806241, 37.5], 
        [-3.441963504368392E-4, 111320.7020576856, 278.2353980772752,   2485758.690035394,      6070.750963243378,      54821.18345352118,      9540.606633304236,      -2710.55326746645,      1405.483844121726, 22.5],
        [-3.218135878613132E-4, 111320.7020701615, 0.00369383431289,    823725.6402795718,      0.46104986909093,       2351.343141331292,      1.58060784298199,       8.77738589078284,       0.37238884252424, 7.45]
    ]
    # 固定值
    cu = [86, 60, 45, 30, 15, 0]
    if lat > 0:
        for idx,i in enumerate(cu):
            if lat > i:
                c = CF[idx]
                break
    else:
        for idx,i in enumerate(cu):
            if lat <= -i:
                c = CF[idx]
                break
    a = {'lng':lng, 'lat':lat}
    q = z
    b = c
    c = b[0] + b[1]*abs(a['lng'])
    e = abs(a['lat'])/b[9]
    e = b[2] + b[3]*e**1 + b[4]*e**2 + b[5]*e**3 + b[6]*e**4 + b[7]*e**5 + b[8]*e**6
    c = c * (-1 if 0 > a['lng'] else 1)
    e = e * (-1 if 0 > a['lat'] else 1)
    lng = c
    lat = e
    def dc(a):  return 2**(18-a)
    def Id():   return 256 # 这里并未确定该参数获取来源，目前固定256，没有任何变化
    def PK(q):  return dc(q)*Id()
    w = dc(q)
    n = PK(q)
    o = math.ceil(lng/n)
    y = math.ceil(lat/n)
    return o-1, y-1, q


lng = 119.2295686287
lat = 34.6023498282
z   = 14 # 高度级别
x,y,z = getxy(lng,lat,z)
print('x:{} y:{} z:{}'.format(x, y, z))

import requests
url = 'https://gss0.bdstatic.com/5bwHcj7lABFY8t_jkk_Z1zRvfdw6buu/it/u=x={};y={};z={};v=009;type=sate&fm=46&udt=20190815'.format(x,y,z)
s = requests.get(url)
filename = 'x{}_y{}_z{}.jpg'.format(x,y,z)
with open(filename, 'wb') as f:
    f.write(s.content)